{"ast":null,"code":"import _regeneratorRuntime from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/marcos/CODE2/week 5/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/marcos/CODE2/week 5/src/pages/login.tsx\";\nimport * as React from \"react\";\nimport * as joi from \"joi\";\nimport { withRouter } from \"react-router-dom\";\nvar credentialSchema = {\n  email: joi.string().email().required(),\n  password: joi.string().min(3).max(30).required()\n};\nexport var LoginInternal =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(LoginInternal, _React$Component);\n\n  function LoginInternal(props) {\n    var _this;\n\n    _classCallCheck(this, LoginInternal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginInternal).call(this, props));\n    _this.state = {\n      email: \"\",\n      password: \"\",\n      error: null\n    };\n    return _this;\n  }\n\n  _createClass(LoginInternal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 32\n        },\n        __self: this\n      }, this._renderServerErrors(), this._renderValidationErrors(), React.createElement(\"input\", {\n        type: \"text\",\n        placeholder: \"Email\",\n        onKeyUp: function onKeyUp(e) {\n          return _this2._updateEmail(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 35\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 40\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        type: \"password\",\n        placeholder: \"Password\",\n        onKeyUp: function onKeyUp(e) {\n          return _this2._updatePassword(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 41\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: function onClick() {\n          return _this2._handleSubmit();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 46\n        },\n        __self: this\n      }, \"Submit\"));\n    }\n  }, {\n    key: \"_renderServerErrors\",\n    value: function _renderServerErrors() {\n      if (this.state.error === null) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 52\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 54\n          },\n          __self: this\n        }, this.state.error);\n      }\n    } // Display errors or OK on screen\n\n  }, {\n    key: \"_renderValidationErrors\",\n    value: function _renderValidationErrors() {\n      var validationResult = joi.validate({\n        email: this.state.email,\n        password: this.state.password\n      }, credentialSchema);\n\n      if (validationResult.error) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 64\n          },\n          __self: this\n        }, validationResult.error.details.map(function (d) {\n          return React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 65\n            },\n            __self: this\n          }, d.message);\n        }));\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68\n          },\n          __self: this\n        }, \"OK!\");\n      }\n    } // Update the state (email) on keyup\n\n  }, {\n    key: \"_updateEmail\",\n    value: function _updateEmail(email) {\n      this.setState({\n        email: email\n      });\n    } // Update the state (password) on keyup\n\n  }, {\n    key: \"_updatePassword\",\n    value: function _updatePassword(password) {\n      this.setState({\n        password: password\n      });\n    } // Send HTTP request on click\n\n  }, {\n    key: \"_handleSubmit\",\n    value: function _handleSubmit() {\n      var _this3 = this;\n\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return getToken(_this3.state.email, _this3.state.password);\n\n              case 3:\n                token = _context.sent;\n\n                // Reset error\n                _this3.setState({\n                  error: null\n                }); // Save token in window object\n\n\n                window.__token = token; // Redirect to home page\n\n                _this3.props.history.push(\"/\");\n\n                _context.next = 12;\n                break;\n\n              case 9:\n                _context.prev = 9;\n                _context.t0 = _context[\"catch\"](0);\n\n                _this3.setState({\n                  error: _context.t0.error\n                });\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 9]]);\n      }))();\n    }\n  }]);\n\n  return LoginInternal;\n}(React.Component); // withRouter pass some props that contain the history to the\n// <LoginInternal> component and returns a new component named\n// <Login>\n\nexport var Login = withRouter(function (props) {\n  return React.createElement(LoginInternal, Object.assign({}, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }));\n});\n\nfunction getToken(_x, _x2) {\n  return _getToken.apply(this, arguments);\n}\n\nfunction _getToken() {\n  _getToken = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(email, password) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", new Promise(function (resolve, reject) {\n              _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee2() {\n                var data, response, json;\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        data = {\n                          email: email,\n                          password: password\n                        };\n                        _context2.next = 3;\n                        return fetch(\"/auth/login\", {\n                          method: \"POST\",\n                          headers: {\n                            \"Content-Type\": \"application/json\"\n                          },\n                          body: JSON.stringify(data)\n                        });\n\n                      case 3:\n                        response = _context2.sent;\n                        _context2.next = 6;\n                        return response.json();\n\n                      case 6:\n                        json = _context2.sent;\n\n                        if (response.status === 200) {\n                          resolve(json.token);\n                        } else {\n                          reject(json);\n                        }\n\n                      case 8:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, this);\n              }))();\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n  return _getToken.apply(this, arguments);\n}","map":{"version":3,"sources":["/home/marcos/CODE2/week 5/src/pages/login.tsx"],"names":["React","joi","withRouter","credentialSchema","email","string","required","password","min","max","LoginInternal","props","state","error","_renderServerErrors","_renderValidationErrors","e","_updateEmail","target","value","_updatePassword","_handleSubmit","validationResult","validate","details","map","d","message","setState","getToken","token","window","__token","history","push","Component","Login","Promise","resolve","reject","data","fetch","method","headers","body","JSON","stringify","response","json","status"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport * as joi from \"joi\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport * as H from 'history';\r\n\r\nconst credentialSchema = {\r\n    email: joi.string().email().required(),\r\n    password: joi.string().min(3).max(30).required()\r\n};\r\n\r\ninterface LoginProps {\r\n    history: H.History;\r\n}\r\n\r\ninterface LoginState {\r\n    email: string;\r\n    password: string;\r\n    error: string | null;\r\n}\r\n\r\nexport class LoginInternal extends React.Component<LoginProps, LoginState> {\r\n    public constructor(props: LoginProps) {\r\n        super(props);\r\n        this.state = {\r\n            email: \"\",\r\n            password: \"\",\r\n            error: null\r\n        };\r\n    }\r\n    public render() {\r\n        return (\r\n            <div>\r\n                {this._renderServerErrors()}\r\n                {this._renderValidationErrors()}\r\n                <input\r\n                    type=\"text\"\r\n                    placeholder=\"Email\"\r\n                    onKeyUp={(e) => this._updateEmail((e as any).target.value)}\r\n                />\r\n                <br></br>\r\n                <input\r\n                    type=\"password\"\r\n                    placeholder=\"Password\"\r\n                    onKeyUp={(e) => this._updatePassword((e as any).target.value)}\r\n                />\r\n                <button onClick={() => this._handleSubmit()}>Submit</button>\r\n            </div>\r\n        );\r\n    }\r\n    private _renderServerErrors() {\r\n        if (this.state.error === null) {\r\n            return <div></div>;\r\n        } else {\r\n            return <div>{this.state.error}</div>;\r\n        }\r\n    }\r\n    // Display errors or OK on screen\r\n    private _renderValidationErrors() {\r\n        const validationResult = joi.validate({\r\n            email: this.state.email,\r\n            password: this.state.password\r\n        }, credentialSchema);\r\n        if (validationResult.error) {\r\n            return <div>\r\n                {validationResult.error.details.map(d => <div>{d.message}</div>)}\r\n            </div>;\r\n        } else {\r\n            return <div>OK!</div>;\r\n        }\r\n    }\r\n    // Update the state (email) on keyup\r\n    private _updateEmail(email: string) {\r\n        this.setState({ email: email });\r\n    }\r\n    // Update the state (password) on keyup\r\n    private _updatePassword(password: string) {\r\n        this.setState({ password: password });\r\n    }\r\n    // Send HTTP request on click\r\n    private _handleSubmit() {\r\n        (async () => {\r\n            try {\r\n                const token = await getToken(this.state.email, this.state.password);\r\n                // Reset error\r\n                this.setState({ error: null });\r\n                // Save token in window object\r\n                (window as any).__token = token;\r\n                // Redirect to home page\r\n                this.props.history.push(\"/\");\r\n            } catch(err) {\r\n                this.setState({ error: err.error });\r\n            }\r\n        })();\r\n    }\r\n}\r\n\r\n// withRouter pass some props that contain the history to the\r\n// <LoginInternal> component and returns a new component named\r\n// <Login>\r\nexport const Login = withRouter(props => <LoginInternal {...props}/>);\r\n\r\nasync function getToken(email: string, password: string) {\r\n    return new Promise(function (resolve, reject) {\r\n        (async () => {\r\n            const data = {\r\n                email: email,\r\n                password: password\r\n            };\r\n            const response = await fetch(\r\n                \"/auth/login\",\r\n                {\r\n                    method: \"POST\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/json\"\r\n                    },\r\n                    body: JSON.stringify(data)\r\n                }\r\n            );\r\n            const json = await response.json();\r\n            if (response.status === 200) {\r\n                resolve(json.token);\r\n            } else {\r\n                reject(json);\r\n            }\r\n        })();\r\n    });\r\n}"]},"metadata":{},"sourceType":"module"}