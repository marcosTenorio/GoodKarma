{"ast":null,"code":"import _regeneratorRuntime from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/marcos/Desktop/karma frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/marcos/Desktop/karma frontend/src/pages/register.tsx\";\nimport * as React from \"react\";\nimport * as joi from \"joi\";\nimport { withRouter } from \"react-router-dom\";\nvar credentialSchema = {\n  name: joi.string().required(),\n  email: joi.string().email().required(),\n  password: joi.string().min(3).max(30).required()\n};\nexport var LoginInternal =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(LoginInternal, _React$Component);\n\n  function LoginInternal(props) {\n    var _this;\n\n    _classCallCheck(this, LoginInternal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginInternal).call(this, props));\n    _this.state = {\n      name: \"\",\n      email: \"\",\n      password: \"\",\n      error: null\n    };\n    return _this;\n  }\n\n  _createClass(LoginInternal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 35\n        },\n        __self: this\n      }, this._renderServerErrors(), this._renderValidationErrors(), React.createElement(\"input\", {\n        type: \"text\",\n        placeholder: \"Name\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 38\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 42\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        type: \"text\",\n        placeholder: \"Email\",\n        onKeyUp: function onKeyUp(e) {\n          return _this2._updateEmail(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 43\n        },\n        __self: this\n      }), React.createElement(\"br\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 48\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        type: \"password\",\n        placeholder: \"Password\",\n        onKeyUp: function onKeyUp(e) {\n          return _this2._updatePassword(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 49\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: function onClick() {\n          return _this2._handleSubmit();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 54\n        },\n        __self: this\n      }, \"Submit\"));\n    }\n  }, {\n    key: \"_renderServerErrors\",\n    value: function _renderServerErrors() {\n      if (this.state.error === null) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 60\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 62\n          },\n          __self: this\n        }, this.state.error);\n      }\n    } // Display errors or OK on screen\n\n  }, {\n    key: \"_renderValidationErrors\",\n    value: function _renderValidationErrors() {\n      var validationResult = joi.validate({\n        email: this.state.email,\n        password: this.state.password\n      }, credentialSchema);\n\n      if (validationResult.error) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 72\n          },\n          __self: this\n        }, validationResult.error.details.map(function (d) {\n          return React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 73\n            },\n            __self: this\n          }, d.message);\n        }));\n      } else {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 76\n          },\n          __self: this\n        }, \"OK!\");\n      }\n    } // Update the state (email) on keyup\n\n  }, {\n    key: \"_updateEmail\",\n    value: function _updateEmail(email) {\n      this.setState({\n        email: email\n      });\n    } // Update the state (password) on keyup\n\n  }, {\n    key: \"_updatePassword\",\n    value: function _updatePassword(password) {\n      this.setState({\n        password: password\n      });\n    } // Send HTTP request on click\n\n  }, {\n    key: \"_handleSubmit\",\n    value: function _handleSubmit() {\n      var _this3 = this;\n\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                _context.next = 3;\n                return getToken(_this3.state.name, _this3.state.email, _this3.state.password);\n\n              case 3:\n                token = _context.sent;\n\n                // Reset error\n                _this3.setState({\n                  error: null\n                }); // Save token in window object\n\n\n                window.__token = token; // Redirect to home page\n\n                _this3.props.history.push(\"/\");\n\n                _context.next = 12;\n                break;\n\n              case 9:\n                _context.prev = 9;\n                _context.t0 = _context[\"catch\"](0);\n\n                _this3.setState({\n                  error: _context.t0.error\n                });\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 9]]);\n      }))();\n    }\n  }]);\n\n  return LoginInternal;\n}(React.Component); // withRouter pass some props that contain the history to the\n// <LoginInternal> component and returns a new component named\n// <Login>\n\nexport var Register = withRouter(function (props) {\n  return React.createElement(LoginInternal, Object.assign({}, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }));\n});\n\nfunction getToken(_x, _x2, _x3) {\n  return _getToken.apply(this, arguments);\n}\n\nfunction _getToken() {\n  _getToken = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(name, email, password) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", new Promise(function (resolve, reject) {\n              _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee2() {\n                var data, response, json;\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        data = {\n                          name: name,\n                          email: email,\n                          password: password\n                        };\n                        _context2.next = 3;\n                        return fetch(\"/users\", {\n                          method: \"POST\",\n                          headers: {\n                            \"Content-Type\": \"application/json\"\n                          },\n                          body: JSON.stringify(data)\n                        });\n\n                      case 3:\n                        response = _context2.sent;\n                        _context2.next = 6;\n                        return response.json();\n\n                      case 6:\n                        json = _context2.sent;\n\n                        if (response.status === 200) {\n                          resolve(json.token);\n                        } else {\n                          reject(json);\n                        }\n\n                      case 8:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, this);\n              }))();\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n  return _getToken.apply(this, arguments);\n}","map":{"version":3,"sources":["/home/marcos/Desktop/karma frontend/src/pages/register.tsx"],"names":["React","joi","withRouter","credentialSchema","name","string","required","email","password","min","max","LoginInternal","props","state","error","_renderServerErrors","_renderValidationErrors","e","_updateEmail","target","value","_updatePassword","_handleSubmit","validationResult","validate","details","map","d","message","setState","getToken","token","window","__token","history","push","Component","Register","Promise","resolve","reject","data","fetch","method","headers","body","JSON","stringify","response","json","status"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport * as joi from \"joi\";\nimport { withRouter } from \"react-router-dom\";\nimport * as H from 'history';\n\nconst credentialSchema = {\n    name: joi.string().required(),\n    email: joi.string().email().required(),\n    password: joi.string().min(3).max(30).required()\n};\n\ninterface LoginProps {\n    history: H.History;\n}\n\ninterface LoginState {\n    name: string;\n    email: string;\n    password: string;\n    error: string | null;\n}\n\nexport class LoginInternal extends React.Component<LoginProps, LoginState> {\n    public constructor(props: LoginProps) {\n        super(props);\n        this.state = {\n            name: \"\",\n            email: \"\",\n            password: \"\",\n            error: null\n        };\n    }\n    public render() {\n        return (\n            <div>\n                {this._renderServerErrors()}\n                {this._renderValidationErrors()}\n                <input\n                    type=\"text\"\n                    placeholder=\"Name\"\n                />\n                <br></br>\n                <input\n                    type=\"text\"\n                    placeholder=\"Email\"\n                    onKeyUp={(e) => this._updateEmail((e as any).target.value)}\n                />\n                <br></br>\n                <input\n                    type=\"password\"\n                    placeholder=\"Password\"\n                    onKeyUp={(e) => this._updatePassword((e as any).target.value)}\n                />\n                <button onClick={() => this._handleSubmit()}>Submit</button>\n            </div>\n        );\n    }\n    private _renderServerErrors() {\n        if (this.state.error === null) {\n            return <div></div>;\n        } else {\n            return <div>{this.state.error}</div>;\n        }\n    }\n    // Display errors or OK on screen\n    private _renderValidationErrors() {\n        const validationResult = joi.validate({\n            email: this.state.email,\n            password: this.state.password\n        }, credentialSchema);\n        if (validationResult.error) {\n            return <div>\n                {validationResult.error.details.map(d => <div>{d.message}</div>)}\n            </div>;\n        } else {\n            return <div>OK!</div>;\n        }\n    }\n    // Update the state (email) on keyup\n    private _updateEmail(email: string) {\n        this.setState({ email: email });\n    }\n    // Update the state (password) on keyup\n    private _updatePassword(password: string) {\n        this.setState({ password: password });\n    }\n    // Send HTTP request on click\n    private _handleSubmit() {\n        (async () => {\n            try {\n                const token = await getToken(this.state.name, this.state.email, this.state.password);\n                // Reset error\n                this.setState({ error: null });\n                // Save token in window object\n                (window as any).__token = token;\n                // Redirect to home page\n                this.props.history.push(\"/\");\n            } catch(err) {\n                this.setState({ error: err.error });\n            }\n        })();\n    }\n}\n\n// withRouter pass some props that contain the history to the\n// <LoginInternal> component and returns a new component named\n// <Login>\nexport const Register = withRouter(props => <LoginInternal {...props}/>);\n\nasync function getToken(name: string, email: string, password: string) {\n    return new Promise(function (resolve, reject) {\n        (async () => {\n            const data = {\n                name: name,\n                email: email,\n                password: password\n            };\n            const response = await fetch(\n                \"/users\",\n                {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\"\n                    },\n                    body: JSON.stringify(data)\n                }\n            );\n            const json = await response.json();\n            if (response.status === 200) {\n                resolve(json.token);\n            } else {\n                reject(json);\n            }\n        })();\n    });\n}"]},"metadata":{},"sourceType":"module"}