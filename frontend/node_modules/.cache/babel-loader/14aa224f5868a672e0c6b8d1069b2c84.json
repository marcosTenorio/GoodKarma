{"ast":null,"code":"import _regeneratorRuntime from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/marcos/Desktop/Karma/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/marcos/Desktop/Karma/frontend/src/pages/login.tsx\";\nimport * as React from \"react\";\nimport * as joi from \"joi\";\nimport { withRouter } from \"react-router-dom\";\nimport { setAuthToken } from \"../components/with_auth/with_auth\";\nvar credentialSchema = {\n  email: joi.string().email().required(),\n  password: joi.string().min(3).max(30).required()\n};\nexport var LoginOrRegisterInternal =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(LoginOrRegisterInternal, _React$Component);\n\n  function LoginOrRegisterInternal(props) {\n    var _this;\n\n    _classCallCheck(this, LoginOrRegisterInternal);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(LoginOrRegisterInternal).call(this, props));\n    _this.state = {\n      name: \"\",\n      email: \"\",\n      password: \"\",\n      nameErr: \"\",\n      emailErr: \"\",\n      passwordErr: \"\",\n      error: null\n    };\n    return _this;\n  }\n\n  _createClass(LoginOrRegisterInternal, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        className: \"login-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 42\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 43\n        },\n        __self: this\n      }, this.props.isLogin ? \"Log In\" : \"Register\"), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 44\n        },\n        __self: this\n      }), !this.props.isLogin ? this._renderRegister() : \"\", React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 52\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: \"input-text\",\n        style: {\n          width: \"80%\"\n        },\n        type: \"text\",\n        placeholder: \"e-mail\",\n        required: true,\n        onKeyUp: function onKeyUp(e) {\n          return _this2._updateEmail(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 53\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"error-msg\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 62\n        },\n        __self: this\n      }, this.state.emailErr), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: \"input-text\",\n        style: {\n          width: \"80%\"\n        },\n        type: \"password\",\n        placeholder: \"password\",\n        required: true,\n        onKeyUp: function onKeyUp(e) {\n          return _this2._updatePassword(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 66\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 75\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        onClick: function onClick() {\n          return _this2._handleSubmit();\n        },\n        className: \"btn\",\n        style: {\n          width: \"30%\"\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, \"Submit\")));\n    }\n  }, {\n    key: \"_renderServerErrors\",\n    value: function _renderServerErrors() {\n      if (this.state.error === null) {\n        return React.createElement(\"div\", {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 89\n          },\n          __self: this\n        });\n      } else {\n        return React.createElement(\"div\", {\n          className: \"error-msg\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 91\n          },\n          __self: this\n        }, this.state.error);\n      }\n    } // Display errors or OK on screen\n\n  }, {\n    key: \"_renderValidationErrors\",\n    value: function _renderValidationErrors() {\n      var nameErr = \"\";\n      var emailErr = \"\";\n\n      if (!this.state.name) {\n        nameErr = \"name cannot be blank\";\n      }\n\n      if (!this.state.email.includes(\"@\")) {\n        emailErr = \"invalid email\";\n      }\n\n      if (nameErr || emailErr) {\n        this.setState({\n          nameErr: nameErr,\n          emailErr: emailErr\n        });\n        return false;\n      }\n\n      return true; // const validationResult = joi.validate({\n      //     email: this.state.email,\n      //     password: this.state.password\n      // }, credentialSchema);\n      // if (validationResult.error) {\n      //     return <div className=\"error-msg\">\n      //         {validationResult.error.details.map((d, i) => <div key={i}>{d.message}</div>)}\n      //     </div>;\n      // } else {\n      //     return <div className=\"success-msg\">OK! </div>;\n      // }\n    }\n  }, {\n    key: \"_renderRegister\",\n    value: function _renderRegister() {\n      var _this3 = this;\n\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        className: \"input-text\",\n        style: {\n          width: \"80%\"\n        },\n        type: \"text\",\n        placeholder: \"name\",\n        onKeyUp: function onKeyUp(e) {\n          return _this3._updateName(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        className: \"error-msg\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }, this.state.nameErr));\n    } // Update the state (name) on keyup\n\n  }, {\n    key: \"_updateName\",\n    value: function _updateName(name) {\n      this.setState({\n        name: name\n      });\n    } // Update the state (email) on keyup\n\n  }, {\n    key: \"_updateEmail\",\n    value: function _updateEmail(email) {\n      this.setState({\n        email: email\n      });\n    } // Update the state (password) on keyup\n\n  }, {\n    key: \"_updatePassword\",\n    value: function _updatePassword(password) {\n      this.setState({\n        password: password\n      });\n    } // Send HTTP request on click\n\n  }, {\n    key: \"_handleSubmit\",\n    value: function _handleSubmit() {\n      var _this4 = this;\n\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var isValid, token;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                isValid = _this4._renderValidationErrors();\n\n                if (!isValid) {\n                  _context.next = 16;\n                  break;\n                }\n\n                if (!_this4.props.isLogin) {\n                  _context.next = 12;\n                  break;\n                }\n\n                // Reset error\n                _this4.setState({\n                  error: null\n                }); //Call server\n\n\n                _context.next = 7;\n                return getToken(_this4.state.email, _this4.state.password);\n\n              case 7:\n                token = _context.sent;\n                // Save token in window object\n                //(window as any).__token = token;\n                setAuthToken(token); // Redirect to home page\n\n                _this4.props.history.push(\"/\");\n\n                _context.next = 16;\n                break;\n\n              case 12:\n                // Reset error\n                _this4.setState({\n                  error: null\n                }); // Call server\n\n\n                _context.next = 15;\n                return createUserAccount(_this4.state.name, _this4.state.email, _this4.state.password);\n\n              case 15:\n                // Redirect to sign in page\n                _this4.props.history.push(\"/login\");\n\n              case 16:\n                _context.next = 21;\n                break;\n\n              case 18:\n                _context.prev = 18;\n                _context.t0 = _context[\"catch\"](0);\n\n                _this4.setState({\n                  error: _context.t0.error\n                });\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 18]]);\n      }))();\n    }\n  }]);\n\n  return LoginOrRegisterInternal;\n}(React.Component); // withRouter pass some props that contain the history to the\n// <LoginOrRegisterInternal> component and returns a new component named\n// <Login>\n\nexport var Login = withRouter(function (props) {\n  return React.createElement(LoginOrRegisterInternal, Object.assign({\n    isLogin: true\n  }, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195\n    },\n    __self: this\n  }));\n});\nexport var Register = withRouter(function (props) {\n  return React.createElement(LoginOrRegisterInternal, Object.assign({\n    isLogin: false\n  }, props, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196\n    },\n    __self: this\n  }));\n});\n\nfunction getToken(_x, _x2) {\n  return _getToken.apply(this, arguments);\n}\n\nfunction _getToken() {\n  _getToken = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(email, password) {\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            return _context3.abrupt(\"return\", new Promise(function (resolve, reject) {\n              _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee2() {\n                var data, response, json;\n                return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n                  while (1) {\n                    switch (_context2.prev = _context2.next) {\n                      case 0:\n                        data = {\n                          email: email,\n                          password: password\n                        };\n                        _context2.next = 3;\n                        return fetch(\"/auth/login\", {\n                          method: \"POST\",\n                          headers: {\n                            \"Content-Type\": \"application/json\"\n                          },\n                          body: JSON.stringify(data)\n                        });\n\n                      case 3:\n                        response = _context2.sent;\n                        _context2.next = 6;\n                        return response.json();\n\n                      case 6:\n                        json = _context2.sent;\n\n                        if (response.status === 200) {\n                          resolve(json.token);\n                        } else {\n                          reject(json);\n                        }\n\n                      case 8:\n                      case \"end\":\n                        return _context2.stop();\n                    }\n                  }\n                }, _callee2, this);\n              }))();\n            }));\n\n          case 1:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3, this);\n  }));\n  return _getToken.apply(this, arguments);\n}\n\nfunction createUserAccount(_x3, _x4, _x5) {\n  return _createUserAccount.apply(this, arguments);\n}\n\nfunction _createUserAccount() {\n  _createUserAccount = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee5(name, email, password) {\n    return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            return _context5.abrupt(\"return\", new Promise(function (resolve, reject) {\n              _asyncToGenerator(\n              /*#__PURE__*/\n              _regeneratorRuntime.mark(function _callee4() {\n                var data, response, json;\n                return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                  while (1) {\n                    switch (_context4.prev = _context4.next) {\n                      case 0:\n                        data = {\n                          name: name,\n                          email: email,\n                          password: password\n                        };\n                        _context4.next = 3;\n                        return fetch(\"/users\", {\n                          method: \"POST\",\n                          headers: {\n                            \"Content-Type\": \"application/json\"\n                          },\n                          body: JSON.stringify(data)\n                        });\n\n                      case 3:\n                        response = _context4.sent;\n                        _context4.next = 6;\n                        return response.json();\n\n                      case 6:\n                        json = _context4.sent;\n\n                        if (response.status === 200) {\n                          resolve(json.token);\n                        } else {\n                          reject(json);\n                        }\n\n                      case 8:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }\n                }, _callee4, this);\n              }))();\n            }));\n\n          case 1:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5, this);\n  }));\n  return _createUserAccount.apply(this, arguments);\n}","map":{"version":3,"sources":["/home/marcos/Desktop/Karma/frontend/src/pages/login.tsx"],"names":["React","joi","withRouter","setAuthToken","credentialSchema","email","string","required","password","min","max","LoginOrRegisterInternal","props","state","name","nameErr","emailErr","passwordErr","error","isLogin","_renderRegister","width","e","_updateEmail","target","value","_updatePassword","_handleSubmit","includes","setState","_updateName","isValid","_renderValidationErrors","getToken","token","history","push","createUserAccount","Component","Login","Register","Promise","resolve","reject","data","fetch","method","headers","body","JSON","stringify","response","json","status"],"mappings":"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","sourcesContent":["import * as React from \"react\";\r\nimport * as joi from \"joi\";\r\nimport { withRouter } from \"react-router-dom\";\r\nimport * as H from 'history';\r\nimport { setAuthToken } from \"../components/with_auth/with_auth\";\r\n\r\nconst credentialSchema = {\r\n    email: joi.string().email().required(),\r\n    password: joi.string().min(3).max(30).required()\r\n};\r\n\r\ninterface LoginOrRegisterProps {\r\n    history: H.History;\r\n    isLogin: boolean;\r\n}\r\n\r\ninterface LoginOrRegisterState {\r\n    name: string;\r\n    email: string;\r\n    password: string;\r\n    nameErr: string;\r\n    emailErr: string;\r\n    passwordErr: string;\r\n    error: string | null;\r\n}\r\n\r\nexport class LoginOrRegisterInternal extends React.Component<LoginOrRegisterProps, LoginOrRegisterState> {\r\n    public constructor(props: LoginOrRegisterProps) {\r\n        super(props);\r\n        this.state = {\r\n            name: \"\",\r\n            email: \"\",\r\n            password: \"\",\r\n            nameErr: \"\",\r\n            emailErr: \"\",\r\n            passwordErr: \"\",\r\n            error: null\r\n        };\r\n    }\r\n    public render() {\r\n        return (\r\n           <div className=\"login-container\">\r\n                <h1>{this.props.isLogin ? \"Log In\" : \"Register\"}</h1>\r\n                <div>\r\n                    {/* {this._renderServerErrors()}\r\n                    {this._renderValidationErrors()} */}\r\n                </div>\r\n                {\r\n                    !this.props.isLogin ? this._renderRegister() : \"\"\r\n                    \r\n                }             \r\n                <div>\r\n                    <input\r\n                        className=\"input-text\"\r\n                        style={{ width: \"80%\"}}\r\n                        type=\"text\"\r\n                        placeholder=\"e-mail\"\r\n                        required\r\n                        onKeyUp={(e) => this._updateEmail((e as any).target.value)}\r\n                    />\r\n                </div>\r\n                <div className=\"error-msg\">\r\n                    {this.state.emailErr}\r\n                </div>\r\n                <div>\r\n                    <input\r\n                        className=\"input-text\"\r\n                        style={{ width: \"80%\"}}\r\n                        type=\"password\"\r\n                        placeholder=\"password\"\r\n                        required\r\n                        onKeyUp={(e) => this._updatePassword((e as any).target.value)}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <button\r\n                        onClick={() => this._handleSubmit()}\r\n                        className=\"btn\"\r\n                        style={{ width: \"30%\"}}\r\n                    >\r\n                    Submit\r\n                    </button>\r\n                </div>\r\n           </div>\r\n        );\r\n    }\r\n    private _renderServerErrors() {\r\n        if (this.state.error === null) {\r\n            return <div></div>;\r\n        } else {\r\n            return <div className=\"error-msg\">{this.state.error}</div>;\r\n        }\r\n    }\r\n\r\n    // Display errors or OK on screen\r\n    private _renderValidationErrors() {\r\n        let nameErr = \"\";\r\n        let emailErr = \"\";\r\n\r\n        if(!this.state.name){\r\n            nameErr = \"name cannot be blank\";\r\n        }\r\n        \r\n        if(!this.state.email.includes(\"@\")){\r\n            emailErr = \"invalid email\";\r\n        }\r\n\r\n        if(nameErr || emailErr){\r\n            this.setState({nameErr, emailErr});\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n        \r\n        \r\n        // const validationResult = joi.validate({\r\n        //     email: this.state.email,\r\n        //     password: this.state.password\r\n        // }, credentialSchema);\r\n        // if (validationResult.error) {\r\n        //     return <div className=\"error-msg\">\r\n        //         {validationResult.error.details.map((d, i) => <div key={i}>{d.message}</div>)}\r\n        //     </div>;\r\n        // } else {\r\n        //     return <div className=\"success-msg\">OK! </div>;\r\n        // }\r\n    };\r\n\r\n    private _renderRegister(){\r\n        return <div>\r\n            <input\r\n                className=\"input-text\"\r\n                style={{ width: \"80%\"}}\r\n                type=\"text\"\r\n                placeholder=\"name\"\r\n                onKeyUp={(e) => this._updateName((e as any).target.value)}\r\n            />\r\n            <div className=\"error-msg\">\r\n                {this.state.nameErr}\r\n            </div>\r\n        </div>\r\n        \r\n    }\r\n    // Update the state (name) on keyup\r\n    private _updateName(name: string) {\r\n        this.setState({ name: name });\r\n    }\r\n    // Update the state (email) on keyup\r\n    private _updateEmail(email: string) {\r\n        this.setState({ email: email });\r\n    }\r\n    // Update the state (password) on keyup\r\n    private _updatePassword(password: string) {\r\n        this.setState({ password: password });\r\n    }\r\n    // Send HTTP request on click\r\n    private _handleSubmit() {\r\n        (async () => {\r\n            try {\r\n                const isValid = this._renderValidationErrors();\r\n            \r\n                if(isValid){\r\n                    if (this.props.isLogin) {\r\n                    // Reset error\r\n                    this.setState({ error: null });\r\n                    //Call server\r\n                    const token = await getToken(this.state.email, this.state.password);\r\n                    // Save token in window object\r\n                    //(window as any).__token = token;\r\n                    setAuthToken(token);\r\n                    // Redirect to home page\r\n                    this.props.history.push(\"/\");\r\n                } else {\r\n                    // Reset error\r\n                    this.setState({ error: null });\r\n                    // Call server\r\n                    await createUserAccount(this.state.name, this.state.email, this.state.password);\r\n                    // Redirect to sign in page\r\n                    this.props.history.push(\"/login\")\r\n                }\r\n                }\r\n\r\n                \r\n                \r\n            } catch(err) {\r\n                this.setState({ error: err.error });\r\n            }\r\n        })();\r\n    }\r\n}\r\n\r\n// withRouter pass some props that contain the history to the\r\n// <LoginOrRegisterInternal> component and returns a new component named\r\n// <Login>\r\nexport const Login = withRouter(props => <LoginOrRegisterInternal isLogin={true} {...props}/>);\r\nexport const Register = withRouter(props => <LoginOrRegisterInternal isLogin={false} {...props}/>);\r\n\r\nasync function getToken(email: string, password: string) {\r\n    return new Promise<string>(function (resolve, reject) {\r\n        (async () => {\r\n            const data = {\r\n                email: email,\r\n                password: password\r\n            };\r\n            const response = await fetch(\r\n                \"/auth/login\",\r\n                {\r\n                    method: \"POST\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/json\"\r\n                    },\r\n                    body: JSON.stringify(data)\r\n                }\r\n            );\r\n            const json = await response.json();\r\n            if (response.status === 200) {\r\n                resolve(json.token);\r\n            } else {\r\n                reject(json);\r\n            }\r\n        })();\r\n    });\r\n}\r\n\r\nasync function createUserAccount(name: string, email: string, password: string) {\r\n    return new Promise<string>(function (resolve, reject) {\r\n        (async () => {\r\n            const data = {\r\n                name: name,\r\n                email: email,\r\n                password: password\r\n            };\r\n            const response = await fetch(\r\n                \"/users\",\r\n                {\r\n                    method: \"POST\",\r\n                    headers: {\r\n                        \"Content-Type\": \"application/json\"\r\n                    },\r\n                    body: JSON.stringify(data)\r\n                }\r\n            );\r\n            const json = await response.json();\r\n            if (response.status === 200) {\r\n                resolve(json.token);\r\n            } else {\r\n                reject(json);\r\n            }\r\n        })();\r\n    });\r\n}"]},"metadata":{},"sourceType":"module"}